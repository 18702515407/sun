<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="shortcut icon" href="img/index.ico" />
		<script src="js/jquery-1.11.0.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/jquery.cookie.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/cart.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type="text/css" href="font-awesome-4.6.3/css/font-awesome.css" />
		<link rel="stylesheet" type="text/css" href="font-awesome-4.6.3/css/font-awesome.min.css" />
		<link rel="stylesheet" type="text/css" href="css/cart.css" />
		<link rel="stylesheet" type="text/css" href="css/public.css" />
	</head>

	<body>
		<div id="best-nav">
			<div class="">
				<a href="index.html" style="float: left;"><img class="best-logo" src="img/active/logo_116x36.png" width="58" height="18" /></a>
				<div class="">
					<ul class="best-ul">
						<li class="best-li">
							<a class="best-li-title" href="aim.html" title="穷游目的地">目的地</a>
						</li>
						<li class="best-li">
							<a class="best-li-title" href="javascript:;" title="穷游锦囊">锦囊</a>
						</li>
						<li class="best-li">
							<a class="best-li-title" href="plan.html" title="穷游行程助手">行程助手</a>
						</li>
						<li class="best-li best-li4">
							<a class="best-li-title" href="javascript:;" title="穷游论坛">社区<i class=""></i></a>
							<div class="best-nav-list1" style="display: none;z-index: 10;">
								<ul>
									<li class="best-nav-list1-li best-nav-list1-li1">
										<a href="javascript:;" title="穷游论坛"><i style="background: url(img/active/381.png)10px ;"></i> 旅行论坛 &nbsp;&gt;<i class=""></i></a>
										<div class="best-nav-list1-li1-list" style="display: none;">
											<div class="best-nav-list1-li1-list-top">
												<div class="b">
													<a class="best-li-title left" href="javascript:;">全部版块<i class=""></i></a>
													<span class="right">热门版块</span>
												</div>

												<dl class="">
													<dt>兴趣小组</dt>
													<dd>
														<a href="javascript:;">结伴同游</a>
														<a href="javascript:;">签证</a>
														<a href="javascript:;">旅行摄影</a>
														<a href="javascript:;">潜水俱乐部</a>
														<a href="javascript:;">带孩子旅行</a>
														<a href="javascript:;">明信片</a>
														<a href="javascript:;">旅行购物</a>
													</dd>
												</dl>
												<dl class="">
													<dt>穷游欧洲</dt>
													<dd>
														<a href="javascript:;">法国/摩纳哥</a>
														<a href="javascript:;">德国</a>
														<a href="javascript:;">英国/爱尔兰</a>
														<a href="javascript:;">瑞士/列支敦士登</a>
														<a href="javascript:;">土耳其</a>
														<a href="javascript:;">挪威/瑞典/芬兰/丹麦/冰岛</a>
														<a href="javascript:;">意大利/梵蒂冈/圣马力诺/马耳他</a>
													</dd>
												</dl>
												<dl class="">
													<dt>穷游亚洲</dt>
													<dd>
														<a href="javascript:;">台湾</a>
														<a href="javascript:;">日本</a>
														<a href="javascript:;">泰国</a>
														<a href="javascript:;">新加坡</a>
														<a href="javascript:;">斯里兰卡</a>
														<a href="javascript:;">韩国/朝鲜</a>
														<a href="javascript:;">香港/澳门</a>
														<a href="javascript:;">马来西亚/文莱</a>
														<a href="javascript:;">柬埔寨</a>
														<a href="javascript:;">马尔代夫</a>
														<a href="javascript:;">缅甸</a>
														<a href="javascript:;">伊朗</a>
														<a href="javascript:;">印度/孟加拉</a>
													</dd>
												</dl>
												<dl class="">
													<dt>穷游美洲</dt>
													<dd>
														<a href="javascript:;">加拿大</a>
														<a href="javascript:;">美国</a>
														<a href="javascript:;">中美</a>
														<a href="javascript:;">南美/南极</a>
													</dd>
												</dl>
												<dl class="">
													<dt>穷游大洋洲</dt>
													<dd>
														<a href="javascript:;">澳大利亚</a>
														<a href="javascript:;">新西兰</a>
														<a href="javascript:;">太平洋海岛</a>
													</dd>
												</dl>
												<dl class="">
													<dt>穷游非洲</dt>
													<dd>
														<a href="javascript:;">东非地区</a>
														<a href="javascript:;">非洲海岛</a>
														<a href="javascript:;">北非地区</a>
														<a href="javascript:;">非洲其他国家</a>
													</dd>
												</dl>

											</div>
										</div>
									</li>
									<li class="best-nav-list1-li">
										<a href="javascript:;" title="穷游问答"><i></i> 旅行问答</a>
									</li>
									<li class="best-nav-list1-li">
										<a href="javascript:;" title="JNE旅行生活美学" target="_blank"><i></i> JNE旅行生活美学</a>
									</li>
								</ul>
							</div>
						</li>

						<script>
							$(function() {
								$(".best-li4").hover(function() {
									$(".best-nav-list1").stop().show(500)
								}, function() {
									$(".best-nav-list1").stop().hide(500);
								})

								$(".best-nav-list1-li1").hover(function() {
									$(".best-nav-list1-li1-list").stop().show(500)
								}, function() {
									$(".best-nav-list1-li1-list").stop().hide(500);
								})

								$(".best-li8").hover(function() {
									$(".best-nav-list2").stop().show(500)
								}, function() {
									$(".best-nav-list2").stop().hide(500);
								})

							})
						</script>

						<li class="best-li">
							<a class="best-li-title" href="javascript:;" title="最世界·自由行">最世界<span class="">·</span>自由行</a>

						</li>

						<li class="best-li">
							<a class="best-li-title" href="jipiao.html" title="机票">机票</a>
						</li>

						<li class="best-li">
							<a class="best-li-title" href="javascript:;" title="穷游酒店">酒店</a>
						</li>

						<li class="best-li best-li8">
							<span class="best-li-title">预订<i class=""></i></span>
							<div class="best-nav-list2" style="display: none; z-index: 10;">
								<ul class="best-nav-list2-ul">

									<li>
										<a href="javascript:;" title="特价酒店"><i class=""></i> 特价酒店</a>
									</li>

									<li>
										<a href="javascript:;" title="保险"><i class=""></i> 保险</a>
									</li>
									<li>
										<a href="javascript:;" title="华人旅馆"><i class=""></i> 华人旅馆</a>
									</li>
									<li>
										<a href="javascript:;" title="邮轮"><i class=""></i> 邮轮</a>
									</li>
									<li>
										<a href="javascript:;" title="租车"><i class=""></i> 租车</a>
									</li>
								</ul>
							</div>
						</li>

					</ul>
				</div>
				<ul class="best-nav_r right ">
					<li>
						<div class="search">
							<input type="text" style="border:0;float: left;display: none;" width="168" height="20" />
							<i class="fa fa-search "></i>
						</div>

					</li>
					<li class="second">
						<i class="fa fa-qq"></i>
						<i class="fa fa-weibo"></i>
						<i class="fa fa-weixin"></i>
					</li>
					<li class="third" id="login">

					</li>
					<script type="text/javascript">
						$(function() {
							// 获取到已登录的用户名
							var loginedUser = $.cookie("loginedUser");
							if(loginedUser) {
								$('#login').append("<a href='myself.html'>" + loginedUser + "</a>");
								var myA = $("<a href='login.html'>注销</a>");
								myA.click(function() {
									var res = $.removeCookie("loginedUser", {
										path: "/"
									});
									if(!res) {
										alert("注销失败");
										return false;
									}
								});
								$('#login').append(myA);
							} else {
								$('#login').append("<a href='login.html'>登录</a><a href='register.html'>注册</a>");
							}

						});
					</script>
				</ul>
			</div>
		</div>

		<div class="list">
			<div class="margin3">
				<p class="list-style"><span style="color: #BD362F;">穷游 </span><span> &gt; 购物车</span></p>
			</div>
		</div>
		<div class="list2">
			<div class="margin3">
				<p class="list-style2"><span class="title">穷游购物车 </span><span class="futitle"> 帮你大海捞针</span></p>
			</div>
		</div>

		<!--导航结束-->

		<div class="container">
			<div class="margin3 contain">
				<div class="cartList">
					<ul class="cartHead">
						<li>缩略图</li>
						<li>品名</li>
						<li>单价</li>
						<li>数量</li>
						<li>小计</li>
						<li>操作</li>
					</ul>

					<div class="blank">
						<img style="display: inline-block;" src="img/cart/68424e527c45beb2.gif" />
					</div>
				</div>
			</div>
		</div>
		
		<div class="list66">
			<div class="margin3">
				<input type="button" value="提交订单" />
			</div>
		</div>
		
		<script type="text/javascript">
			$(function (){
				// 取出在cookie中存的购物车信息
				var cartStr = $.cookie("cart") ? $.cookie("cart") : "";
				
				if(!cartStr){
					$(".blank").css({display : "block"});
				} else {
					var cartObj = convertCartStrToObj(cartStr);
					// 遍历所有的商品，生成html添加到购物车列表中去
					for(var id in cartObj){
						// 商品信息对象
						var good = cartObj[id];
						var str = '<ul class="goodInfo" data-good-id="' + id + '">' + 
							'<li><img src="' + good.src + '"></li>' + 
							'<li>' + good.name + '</li>' + 
							'<li>' + good.price + '</li>' + 
							'<li class="num">' + 
								'<a href="javascript:;" class="minus">-</a>' +
								' <input type="text" value="' + good.num + '" /> ' +
								'<a href="javascript:;" class="plus">+</a>' + 
							'</li>' +
							'<li class="total">' + good.num * good.price + '</li>' +
							'<li><a href="javascript:;" class="del">删除</a></li>' +
						'</ul>';
						
						// 将上面的结构添加到cartList中去
						$(str).appendTo(".cartList");
					}	
					// 给每个商品添加从购物车删除的事件
					$('.goodInfo a.del').click(function (){
						// 在页面上将商品信息删除，顺便获取一下该商品的id
						var id = $(this).parents('.goodInfo').remove().attr("data-good-id");
						// 从cookie中将该商品删除
						var cartStr = $.cookie("cart") ? $.cookie("cart") : "";
						var cartObj = convertCartStrToObj(cartStr);
						delete cartObj[id];
						
						// 将新的商品信息放回cookie
						$.cookie('cart', convertObjToCartStr(cartObj), {expires:7, path:"/"});
					});
					
					// 给增加按钮添加事件
					$(".goodInfo a.plus").click(function (){
						var id = $(this).parents('.goodInfo').attr("data-good-id");
						var cartStr = $.cookie("cart") ? $.cookie("cart") : "";
						var cartObj = convertCartStrToObj(cartStr);
						cartObj[id].num += 1;
						// 将页面上显示的数量加1
						$(this).siblings("input").val("" + cartObj[id].num);
						// 更新页面上的小计
						$(this).parent().siblings('.total').html(cartObj[id].num * cartObj[id].price + "");
						// 将信息放回cookie
						$.cookie('cart', convertObjToCartStr(cartObj), {expires:7, path:"/"});
					});
					
					// 给减按钮添加点击事件
					$(".goodInfo a.minus").click(function (){
						var id = $(this).parents('.goodInfo').attr("data-good-id");
						var cartStr = $.cookie("cart") ? $.cookie("cart") : "";
						var cartObj = convertCartStrToObj(cartStr);
						if (cartObj[id].num > 1){ // 商品数量减少不能少于1
							cartObj[id].num -= 1;
						
							$(this).siblings("input").val("" + cartObj[id].num);
							$(this).parent().siblings('.total').html(cartObj[id].num * cartObj[id].price + "");
							$.cookie('cart', convertObjToCartStr(cartObj), {expires:7, path:"/"});
						}
					});
					
					// 改数量的input绑定一个blur事件
					$(".goodInfo li.num input").blur(function (){
						var id = $(this).parents('.goodInfo').attr("data-good-id");
						var cartStr = $.cookie("cart") ? $.cookie("cart") : "";
						var cartObj = convertCartStrToObj(cartStr);
						// 判断用户输入是否合法
						var pattern = /^\d+$/;
						if(!pattern.test($(this).val())){
							cartObj[id].num = 1;
							$(this).val("1");
						} else {
							// 修改一下数量
							cartObj[id].num = parseInt($(this).val());
						}

						$(this).siblings("input").val("" + cartObj[id].num);
						$(this).parent().siblings('.total').html(cartObj[id].num * cartObj[id].price + "");
						$.cookie('cart', convertObjToCartStr(cartObj), {expires:7, path:"/"});
					});
				}
			});
			
			function convertCartStrToObj(cartStr){
				// 如果是空字符串，即没有购物车信息，那么购物车为空，直接返回一个空对象
				if(!cartStr){
					return {};
				}
				// "sp1,香蕉,30,1,src1:sp2,苹果,40,2,src2:sp3,梨,50,3,src3"
				var goods = cartStr.split(":");
				var obj = {};
				for(var i = 0 ; i < goods.length; i++){
					var data = goods[i].split(",");
					// 以商品的id为键，商品的其他信息为值, 这个值也设计为一个对象
					obj[data[0]] = {
						name : data[1],
						price : parseFloat(data[2]),
						num : parseInt(data[3]),
						src : data[4]
					};
				}
				
				return obj;
			}
			
			function convertObjToCartStr(obj){
					
					var cartStr = "";
					for(var id in obj){
						if(cartStr){
							cartStr += ":";
						}
						cartStr += id + "," + obj[id].name + "," + obj[id].price + "," + obj[id].num + "," + obj[id].src;
					}
					
					return cartStr;
			}
		</script>

		<!--底部1开始-->
		<div id="foot">

			<div class="back margin" style="cursor: pointer;">

			</div>
		</div>

		<!--底部1结束-->

		<!--底部2开始-->
		<div id="foot2">
			<div class="back margin" style="cursor: pointer;">

			</div>
		</div>
		<!--地步2结束-->
	</body>

</html>